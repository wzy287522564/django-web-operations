<!DOCTYPE html>
{% load static %}
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css'%}">
        <script src="{% static 'js/jquery.min.js'%}"></script>

</head>
<style>
        html,body{text-align:center;margin:0px auto;}
</style>
<body>

<div class="container well" style="margin-top: 200px;width: 500px">
    <form class="col-sm-offset-4col-sm-4 col-sm-offset-4 form form-horizontal " action="" method="post" id="login_form" style="margin-left: 0px;" onsubmit="return check()">
        <h3 class="text-center">注册页面</h3>
        <div class="form-group" id="username_div">
            <label for="username" class="col-sm-3 control-label">账&nbsp号</label>
            <div class="col-sm-7">
                <input type="text" class="form-control" id="username" name="username" PLACEHOLDER="请输入手机号">
                <span class="glyphicon glyphicon-ok form-control-feedback" style="display:none" id="username_success"></span>
                <span class="glyphicon glyphicon-remove form-control-feedback" style="display:none" id="username_fail"></span>
                <span id="username_result" style="display:none;padding-right: 120px;"></span>
            </div>
        </div>
        <div class="form-group" id="password_div">
            <label for="password" class="col-sm-3 control-label">密&nbsp码</label>
            <div class="col-sm-7">
                <input type="password" class="form-control" id="password" name="password" PLACEHOLDER="请输入至少6位密码">
                <span class="glyphicon glyphicon-ok form-control-feedback" style="display:none" id="password_success"></span>
                <span class="glyphicon glyphicon-remove form-control-feedback" style="display:none" id="password_fail"></span>
                <span id="password_result" style="display:none;padding-right: 120px;"></span>
            </div>
        </div>
        <div class="form-group" id="password2_div">
            <label for="password2" class="col-sm-3 control-label">确认密码</label>
            <div class="col-sm-7">
                <input type="password" class="form-control" id="password2" name="password2" PLACEHOLDER="请再一次输入密码">
                <span class="glyphicon glyphicon-ok form-control-feedback" style="display:none" id="password2_success"></span>
                <span class="glyphicon glyphicon-remove form-control-feedback" style="display:none" id="password2_fail"></span>
                <span id="password2_result" style="display:none;"></span>
            </div>
        </div>
        <button type="submit" class="btn btn-primary center-block">注册</button>
        <div class="text-right">
            <a href="/login/" >已有账号</a>
        </div>
    </form>
</div>
</body>
<script>
$("#username").blur(function(){
        var username = $(this).val()
        if(username.length!=0){
            var re = /^[1][0-9][0-9]{9}$/;
            if (re.test(username)) {
                $.post('/regist/',{'username':username}).done(function(result){
                    if (result['result']){
                    //用户名已存在
                        $("#username_div").attr("class","form-group has-error has-feedback")
                        $("#username_fail").attr("style","")
                        $("#username_success").attr("style","display:none")
                        $("#username_result").attr("style","padding-right: 120px;")
                        $("#username_result").html(result['result'])
                    }
                    else{
                    //用户名不存在
                        $("#username_div").attr("class","form-group has-success has-feedback")
                        $("#username_success").attr("style","")
                        $("#username_fail").attr("style","display:none")
                        $("#username_result").attr("style","display:none")
                        $("#username_result").html('')
                    }
                })
            }
            else{
            //用户名非手机号
                $("#username_div").attr("class","form-group has-error has-feedback")
                $("#username_fail").attr("style","")
                $("#username_success").attr("style","display:none")
                $("#username_result").attr("style","padding-right: 120px;")
                $("#username_result").html("请输入正确的手机号")
            }
        }
        else{
        //用户名为空
            $("#username_div").attr("class","form-group has-error has-feedback")
            $("#username_fail").attr("style","")
            $("#username_success").attr("style","display:none")
            $("#username_result").attr("style","padding-right: 120px;")
            $("#username_result").html('用户名不能为空')
        }
});

$("#password").blur(function(){
    var password  = $("#password").val()
    if(password.length<6){
    //密码不足6位
        $("#password_div").attr("class","form-group has-error has-feedback")
        $("#password_fail").attr("style","")
        $("#password_success").attr("style","display:none")
        $("#password_result").attr("style","padding-right: 120px;")
        $("#password_result").html('密码不足6位')
    }
    else{
        $("#password_div").attr("class","form-group has-success has-feedback")
        $("#password_success").attr("style","")
        $("#password_fail").attr("style","display:none")
        $("#password_result").attr("style","display:none")
        $("#password_result").html('')
    }
    var password2 = $("#password2").val()
    if(password.length==0 || password2.length==0){
        $("#password2_div").attr("class","form-group")
        $("#password2_fail").attr("style","display:none")
        $("#password2_success").attr("style","display:none")
        $("#password2_result").attr("style","display:none")
        $("#password2_result").html('')
        return
    }
    if(password!=password2){
        $("#password2_div").attr("class","form-group has-error has-feedback")
        $("#password2_fail").attr("style","")
        $("#password2_success").attr("style","display:none")
        $("#password2_result").attr("style","padding-right: 120px;")
        $("#password2_result").html('两次密码不同')
    }
    else{
        $("#password2_div").attr("class","form-group has-success has-feedback")
        $("#password2_success").attr("style","")
        $("#password2_fail").attr("style","display:none")
    }
})

$("#password2").blur(function(){
    var password  = $("#password").val()
    if(password.length==0){
        $("#password2_div").attr("class","form-group")
        $("#password2_fail").attr("style","display:none")
        $("#password2_success").attr("style","display:none")
        return
    }
    var password2 = $("#password2").val()
    if(password!=password2){
        $("#password2_div").attr("class","form-group has-error has-feedback")
        $("#password2_fail").attr("style","")
        $("#password2_success").attr("style","display:none")
        $("#password2_result").attr("style","padding-right: 120px;")
        $("#password2_result").html('两次密码不同')
    }
    else{
        $("#password2_div").attr("class","form-group has-success has-feedback")
        $("#password2_success").attr("style","")
        $("#password2_fail").attr("style","display:none")
        $("#password2_result").attr("style","display:none")
        $("#password2_result").html('')
    }
})

function check(){
    str=$('#username_div').attr('class')
    str2=$('#password_div').attr('class')
    str3=$('#password2_div').attr('class')
    if(str.indexOf("success")!=-1 && str2.indexOf("success")!=-1 && str3.indexOf("success")!=-1){
        return true
    }
    alert("请正确填写")
    return false
}

</script>
</html>